steps:
  - name: "gcr.io/cloud-builders/npm"
    dir: "ui"
    entrypoint: "bash"
    args:
      - "-c"
      - |
        npm ci
        npm run build

  - name: "gcr.io/cloud-builders/gsutil"
    entrypoint: "bash"
    args:
      - "-c"
      - |
        if [ -d "ui/dist" ]; then OUT="ui/dist"; else OUT="ui/build"; fi
        gsutil -m rsync -r -d "$OUT" "gs://${_UI_BUCKET}"

substitutions:
  _UI_BUCKET: "REPLACE_WITH_YOUR_BUCKET_NAME"

options:
  logging: CLOUD_LOGGING_ONLY
